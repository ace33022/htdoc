/** * * @description LibreOffice * * @version 2022/10/18 ace 初始版本。 * * @author ace * * @see <a href="https://www.jopendocument.org/">jOpenDocument Homepage. Open Document library</a> * * @see <a href="https://stackoverflow.com/questions/46468272/how-to-read-ods-document-by-java-and-jopendocument-package">how to read .ods document by java and jopendocument package - Stack Overflow</a> * */ (function(root) {	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.OptionCallDayTrnLog"] + '.js');	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.OptionPutDayTrnLog"] + '.js');		load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.OptionCallLargeStayLog"] + '.js');	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.OptionPutLargeStayLog"] + '.js');	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.OptionCallLargeStayAllLog"] + '.js');	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.OptionPutLargeStayAllLog"] + '.js');		load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.ForeignOptionDayTrnLog"] + '.js');	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.DealerOptionDayTrnLog"] + '.js');	load(tw.ace33022.RequireJSConfig.baseUrl + tw.ace33022.RequireJSConfig.paths["tw.ace33022.dao.db.vo.InvestOptionDayTrnLog"] + '.js');		var beginTrnDate, endTrnDate;		function insertOptionDayTrnLogToSheet(arrVO, sheet) {		var vo;				var index;		var posX = new Number(0);		var posY = new Number(1);				// logger.debug('arrVO.length: ' + arrVO.length);				for (index = 0; index < arrVO.length; index++) {			vo = arrVO[index];								posX = 0;						if (index == 0) beginTrnDate = vo.getTrnDate();			if (index == (arrVO.length - 1)) endTrnDate = vo.getTrnDate();						sheet.setValueAt(vo.getTrnDate(), posX++, posY);			sheet.setValueAt(vo.getConMonth(), posX++, posY);			sheet.setValueAt(vo.getStrikePrice(), posX++, posY);			sheet.setValueAt(vo.getOpenPrice(), posX++, posY);			sheet.setValueAt(vo.getHighPrice(), posX++, posY);			sheet.setValueAt(vo.getLowPrice(), posX++, posY);			sheet.setValueAt(vo.getClosePrice(), posX++, posY);			sheet.setValueAt(vo.getLastCalPrice(), posX++, posY);										// 結算價			sheet.setValueAt(vo.getTrnQty(), posX++, posY);													// 交易量			sheet.setValueAt(vo.getStayQty(), posX++, posY);												// 未平倉量			sheet.setValueAt(vo.getLastCalPrice() * vo.getStayQty(), posX++, posY);	// 未平倉金額						posY++;		}	};		function insertOptionLargeStayLogToSheet(arrVO, sheet) {			var vo;				var index;		var posX = new Number(0);		var posY = new Number(1);				for (index = 0; index < arrVO.length; index++) {			vo = arrVO[index];								posX = 0;						sheet.setValueAt(vo.getTrnDate(), posX++, posY);			sheet.setValueAt(vo.getConMonth(), posX++, posY);			// sheet.setValueAt(vo.getProductCode(), posX++, posY);			sheet.setValueAt(vo.getPreFiveBuy(), posX++, posY);			sheet.setValueAt(vo.getPreFiveJurBuy(), posX++, posY);			sheet.setValueAt(vo.getPreTenBuy(), posX++, posY);			sheet.setValueAt(vo.getPreTenJurBuy(), posX++, posY);			sheet.setValueAt(vo.getPreFiveSell(), posX++, posY);			sheet.setValueAt(vo.getPreFiveJurSell(), posX++, posY);			sheet.setValueAt(vo.getPreTenSell(), posX++, posY);			sheet.setValueAt(vo.getPreTenJurSell(), posX++, posY);			sheet.setValueAt(vo.getStayQty(), posX++, posY);						posY++;		}	}	function insertOptionLargeStayAllLogToSheet(arrVO, sheet) {		var vo;				var index;		var posX = new Number(0);		var posY = new Number(1);				for (index = 0; index < arrVO.length; index++) {			vo = arrVO[index];								posX = 0;						sheet.setValueAt(vo.getTrnDate(), posX++, posY);			// sheet.setValue(vo.getProductCode(), posX++, posY);			sheet.setValueAt(vo.getPreFiveBuy(), posX++, posY);			sheet.setValueAt(vo.getPreFiveJurBuy(), posX++, posY);			sheet.setValueAt(vo.getPreTenBuy(), posX++, posY);			sheet.setValueAt(vo.getPreTenJurBuy(), posX++, posY);			sheet.setValueAt(vo.getPreFiveSell(), posX++, posY);			sheet.setValueAt(vo.getPreFiveJurSell(), posX++, posY);			sheet.setValueAt(vo.getPreTenSell(), posX++, posY);			sheet.setValueAt(vo.getPreTenJurSell(), posX++, posY);			sheet.setValueAt(vo.getStayQty(), posX++, posY);						posY++;		}	}		function insertFoundationOptionDayTrnLogToSheet(arrVO, sheet) {		var vo;				var index;		var posX = new Number(0);		var posY = new Number(1);				for (index = 0; index < arrVO.length; index++) {			vo = arrVO[index];								posX = 0;						sheet.setValueAt(vo.getTrnDate(), posX++, posY);			sheet.setValueAt(vo.getCallBuyQty(), posX++, posY);			sheet.setValueAt(vo.getCallBuyTotal(), posX++, posY);			sheet.setValueAt(vo.getCallSellQty(), posX++, posY);			sheet.setValueAt(vo.getCallSellTotal(), posX++, posY);			sheet.setValueAt(vo.getPutBuyQty(), posX++, posY);			sheet.setValueAt(vo.getPutBuyTotal(), posX++, posY);			sheet.setValueAt(vo.getPutSellQty(), posX++, posY);			sheet.setValueAt(vo.getPutSellTotal(), posX++, posY);			sheet.setValueAt(vo.getStayCallBuyQty(), posX++, posY);			sheet.setValueAt(vo.getStayCallBuyTotal(), posX++, posY);			sheet.setValueAt(vo.getStayCallSellQty(), posX++, posY);			sheet.setValueAt(vo.getStayCallSellTotal(), posX++, posY);			sheet.setValueAt(vo.getStayPutBuyQty(), posX++, posY);			sheet.setValueAt(vo.getStayPutBuyTotal(), posX++, posY);			sheet.setValueAt(vo.getStayPutSellQty(), posX++, posY);			sheet.setValueAt(vo.getStayPutSellTotal(), posX++, posY);						posY++;		}	}		function generateOptionODSFile(productCode, conMonth, templateFile, targetFile) {			var year = conMonth.substring(0, 4);		var month = conMonth.substring(4);				var spreadSheet = Packages.org.jopendocument.dom.spreadsheet.SpreadSheet.createFromFile(templateFile);		// var sheet;				// logger.debug('spreadSheet.getSheetCount(): ' + spreadSheet.getSheetCount());		// for (index = 0; index < spreadSheet.getSheetCount(); index++) Logger.info(' ' + spreadSheet.getSheet(index).getName());				// print(new String(year + month));				insertOptionDayTrnLogToSheet((new tw.ace33022.dao.db.vo.OptionCallDayTrnLog(Configuration.Database.getConnection())).doSelectByConMonthOrderByTrnDateAndStrikePrice(productCode, new String(year + month)), spreadSheet.getSheet('option_call_day_trn_log'));		insertOptionDayTrnLogToSheet((new tw.ace33022.dao.db.vo.OptionPutDayTrnLog(Configuration.Database.getConnection())).doSelectByConMonthOrderByTrnDateAndStrikePrice(productCode, new String(year + month)), spreadSheet.getSheet('option_put_day_trn_log'));				// sheet = spreadSheet.getSheet('option_call_day_trn_log');		// sheet = spreadSheet.getSheet('option_put_day_trn_log');		// logger.info('sheet.getColumnCount(): ' + sheet.getColumnCount());	// 取得的並不是使用的Column值，而是Sheet的Column值。		// logger.info('sheet.getRowCount(): ' + sheet.getRowCount());				// 取得的並不是使用的Row值，而是Sheet的Row值。					insertOptionLargeStayLogToSheet((new tw.ace33022.dao.db.vo.OptionCallLargeStayLog(Configuration.Database.getConnection())).doSelectByConMonthOrderByTrnDate(productCode, new String(year + month)), spreadSheet.getSheet('option_call_large_stay_log'));		insertOptionLargeStayLogToSheet((new tw.ace33022.dao.db.vo.OptionPutLargeStayLog(Configuration.Database.getConnection())).doSelectByConMonthOrderByTrnDate(productCode, new String(year + month)), spreadSheet.getSheet('option_put_large_stay_log'));					if (month.indexOf('W') == -1) {					// logger.debug('beginTrnDate: ' + beginTrnDate);			// logger.debug('endTrnDate: ' + endTrnDate);						insertOptionLargeStayAllLogToSheet((new tw.ace33022.dao.db.vo.OptionCallLargeStayAllLog(Configuration.Database.getConnection())).doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode), spreadSheet.getSheet('option_call_large_stay_all_log'));			insertOptionLargeStayAllLogToSheet((new tw.ace33022.dao.db.vo.OptionPutLargeStayAllLog(Configuration.Database.getConnection())).doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode), spreadSheet.getSheet('option_put_large_stay_all_log'));					insertFoundationOptionDayTrnLogToSheet((new tw.ace33022.dao.db.vo.ForeignOptionDayTrnLog(Configuration.Database.getConnection())).doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode), spreadSheet.getSheet('foreign_option_day_trn_log'));			insertFoundationOptionDayTrnLogToSheet((new tw.ace33022.dao.db.vo.DealerOptionDayTrnLog(Configuration.Database.getConnection())).doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode), spreadSheet.getSheet('dealer_option_day_trn_log'));			insertFoundationOptionDayTrnLogToSheet((new tw.ace33022.dao.db.vo.InvestOptionDayTrnLog(Configuration.Database.getConnection())).doSelectBetweenTrnDateOrderByTrnDate(beginTrnDate, endTrnDate, productCode), spreadSheet.getSheet('invest_option_day_trn_log'));		}				spreadSheet.saveAs(new Packages.java.io.File(targetFile));	}		if (typeof root.tw.ace33022.functions.LibreOffice == 'undefined') root.tw.ace33022.functions.LibreOffice = {};		root.tw.ace33022.functions.LibreOffice.generateOptionODSFile = generateOptionODSFile;})(this);